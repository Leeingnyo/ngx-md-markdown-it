{"version":3,"sources":["ng://ngx-md/lib/ngx-md.service.ts","ng://ngx-md/lib/ngx-md.component.ts","ng://ngx-md/lib/ngx-md.config.ts","ng://ngx-md/lib/ngx-md.module.ts"],"names":["NgxMdService","_http","this","MarkdownIt","linkify","use","MarkdownItFootnote","extendRenderer","setMarkedOptions","prototype","getContent","path","get","responseType","pipe","map","res","catchError","handleError","options","Object","assign","gfm","tables","breaks","pedantic","sanitize","smartLists","smartypants","compile","data","_renderer","render","defaultRender","renderer","rules","link_open","tokens","idx","env","self","renderToken","aIndex","attrIndex","attrPush","attrs","currentPageLinkWithoutHash","location","origin","pathname","search","footnote_ref","render_footnote_ref","slf","id","footnote_anchor_name","caption","footnote_caption","refid","meta","subId","footnote_anchor","render_footnote_anchor","error","errMsg","fetch","body","json","err","JSON","stringify","status","statusText","message","toString","throwError","Injectable","args","providedIn","HttpClient","NgxMdComponent","_mdService","_el","platformId","defineProperty","value","_path","onPathChange","_data","onDataChange","nativeElement","innerHTML","highlightContent","ngAfterViewInit","processRaw","_md","prepare","decodeHtml","html","txt","document","createElement","_this","_ext","split","splice","join","subscribe","console","Promise","reject","raw","isCodeBlock_1","line","trimLeft","substring","trim","replace","async","isPlatformBrowser","Prism.highlightAll","Component","selector","template","styles","ElementRef","Inject","PLATFORM_ID","Input","NgxMdConfig","NgxMdModule","forRoot","ngModule","providers","NgModule","imports","HttpClientModule","declarations","exports"],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core'\nimport { HttpClient } from '@angular/common/http';\nimport { throwError, Observable } from 'rxjs'\nimport { map, catchError } from 'rxjs/operators';\nimport MarkdownIt from 'markdown-it';\nimport MarkdownItFootnote from 'markdown-it-footnote';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgxMdService {\n  private _renderer: any = MarkdownIt({ linkify: true }).use(MarkdownItFootnote);\n\n  constructor(private _http: HttpClient) {\n    this.extendRenderer();\n    this.setMarkedOptions({});\n  }\n\n  // get the content from remote resource\n  getContent(path: string): Observable<any> {\n      return this._http.get(path, {responseType: 'text'}).pipe(map(res => res), catchError(this.handleError));\n  }\n\n  public setMarkedOptions(options: any) {\n    options = Object.assign({\n      gfm: true,\n      tables: true,\n      breaks: false,\n      pedantic: false,\n      sanitize: false,\n      smartLists: true,\n      smartypants: false\n    }, options);\n    // TODO\n  }\n\n  // comple markdown to html\n  public compile(data: string) {\n     return this._renderer.render(data);\n  }\n\n  // extend marked render to support todo checkbox\n  private extendRenderer() {\n    // make target of anchor tag blank\n    // Remember old renderer, if overriden, or proxy to default renderer\n    const defaultRender = this._renderer.renderer.rules.link_open || function(tokens, idx, options, env, self) {\n      return self.renderToken(tokens, idx, options);\n    };\n    this._renderer.renderer.rules.link_open = function (tokens, idx, options, env, self) {\n      const aIndex = tokens[idx].attrIndex('target');\n\n      if (aIndex < 0) {\n        tokens[idx].attrPush(['target', '_blank']);\n      } else {\n        tokens[idx].attrs[aIndex][1] = '_blank';\n      }\n\n      return defaultRender(tokens, idx, options, env, self);\n    };\n\n    // for angular routeer, add prefix location.href without fragment\n    const currentPageLinkWithoutHash = location.origin + location.pathname + location.search;\n    this._renderer.renderer.rules.footnote_ref = function render_footnote_ref(tokens, idx, options, env, slf) {\n      var id      = slf.rules.footnote_anchor_name(tokens, idx, options, env, slf);\n      var caption = slf.rules.footnote_caption(tokens, idx, options, env, slf);\n      var refid   = id;\n\n      if (tokens[idx].meta.subId > 0) {\n        refid += ':' + tokens[idx].meta.subId;\n      }\n\n      return '<sup class=\"footnote-ref\"><a href=\"' + currentPageLinkWithoutHash + '#fn' + id + '\" id=\"fnref' + refid + '\">' + caption + '</a></sup>';\n    }\n    this._renderer.renderer.rules.footnote_anchor = function render_footnote_anchor(tokens, idx, options, env, slf) {\n      var id = slf.rules.footnote_anchor_name(tokens, idx, options, env, slf);\n\n      if (tokens[idx].meta.subId > 0) {\n        id += ':' + tokens[idx].meta.subId;\n      }\n\n      /* â© with escape code to prevent display as Apple Emoji on iOS */\n      return ' <a href=\"' + currentPageLinkWithoutHash + '#fnref' + id + '\" class=\"footnote-backref\">\\u21a9\\uFE0E</a>';\n    }\n  }\n\n  // handle error\n  private handleError(error: any): any {\n    let errMsg: string;\n    if (error instanceof fetch) {\n      const body = error.json() || '';\n      const err = body.error || JSON.stringify(body);\n      errMsg = `${error.status} - ${error.statusText || ''} ${err}`;\n    } else {\n      errMsg = error.message ? error.message : error.toString();\n    }\n    return throwError(errMsg);\n  }\n}\n","\nimport { Component, ElementRef, OnInit, AfterViewInit, Input, PLATFORM_ID, Inject } from '@angular/core';\nimport { NgxMdService } from './ngx-md.service';\nimport { isPlatformBrowser } from '@angular/common';\nimport * as Prism from 'prismjs';\n\n@Component({\n    selector: 'markdown,[Markdown],ngx-md,[NgxMd]',\n    template: '<ng-content></ng-content>',\n    styles: [\n        `.token.operator, .token.entity, .token.url, .language-css .token.string, .style .token.string {\n            background: none;\n        }`\n    ]\n})\nexport class NgxMdComponent implements  AfterViewInit {\n    private _path: string;\n    private _data: string;\n    private _md: any;\n    private _ext: string;\n    changeLog: string[] = [];\n\n    constructor(\n        private _mdService: NgxMdService,\n        private _el: ElementRef,\n        @Inject(PLATFORM_ID) private platformId: string\n    ) { }\n\n   \n\n    @Input()\n    set path(value: string) {\n      if (value) {\n        this._path = value;\n        this.onPathChange();\n      }\n    }\n\n    @Input()\n    set data(value: string) {\n      if (value) {\n        this._data = value;\n        this.onDataChange(value);\n      }\n    }\n\n\n    // on input\n    onDataChange(data: string) {\n      if (data) {\n        this._el.nativeElement.innerHTML = this._mdService.compile(data);\n      } else {\n        this._el.nativeElement.innerHTML = '';\n      }\n      this.highlightContent(false);\n    }\n\n    /**\n     *  After view init\n     */\n    ngAfterViewInit() {\n      if (this._path) {\n        this.onPathChange();\n      } else if (!this._data) {\n        this.processRaw();\n      }\n    }\n\n    processRaw() {\n      this._md = this.prepare(decodeHtml(this._el.nativeElement.innerHTML));\n      this._el.nativeElement.innerHTML = this._mdService.compile(this._md);\n      this.highlightContent(false);\n    }\n\n    /**\n     * get remote conent;\n     */\n    onPathChange() {\n        this._ext = this._path && this._path.split('.').splice(-1).join();\n        this._mdService.getContent(this._path)\n            .subscribe(data => {\n                this._md = this._ext !== 'md' ? '```' + this._ext + '\\n' + data + '\\n```' : data;\n                this._el.nativeElement.innerHTML = this._mdService.compile(this.prepare(this._md));\n                this.highlightContent(false);\n            },\n            err => this.handleError);\n    }\n\n    /**\n     * catch http error\n     */\n    private handleError(error: any): Promise<any> {\n        console.error('An error occurred', error); // for demo purposes only\n        return Promise.reject(error.message || error);\n    }\n\n    /**\n     * Prepare string\n     */\n     prepare(raw: string) {\n        if (!raw) {\n            return '';\n        }\n        if (this._ext === 'md' || !this.path) {\n            let isCodeBlock = false;\n            return raw.split('\\n').map((line: string) => {\n                if (this.trimLeft(line).substring(0, 3) === '```') {\n                    isCodeBlock = !isCodeBlock;\n                }\n                return isCodeBlock ? line : line.trim();\n            }).join('\\n');\n        }\n        return raw.replace(/\\\"/g, '\\'');\n    }\n\n    /**\n     * Trim left whitespace\n     */\n    private trimLeft(line: string) {\n        return line.replace(/^\\s+|\\s+$/g, '');\n    }\n\n    /**\n     * Use Prism to highlight code snippets only on the browser\n     */\n    private highlightContent(async: boolean): void {\n      if (isPlatformBrowser(this.platformId)) {\n        Prism.highlightAll(async);\n      }\n    }\n}\n\nfunction decodeHtml(html: string) { // https://stackoverflow.com/a/7394787/588521\n    const txt = document.createElement('textarea');\n    txt.innerHTML = html;\n    return txt.value;\n}\n\n","import { Injectable } from '@angular/core';\n\n@Injectable()\nexport class NgxMdConfig {\n  /** config modue */\n\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { HttpClientModule } from '@angular/common/http';\nimport { NgxMdService } from './ngx-md.service';\nimport { NgxMdConfig } from './ngx-md.config';\nimport { NgxMdComponent } from './ngx-md.component';\n\n@NgModule({\n  imports: [HttpClientModule],\n  declarations: [NgxMdComponent],\n  providers: [NgxMdService],\n  exports: [NgxMdComponent],\n})\nexport class NgxMdModule {\n  public static forRoot(): ModuleWithProviders {\n    return {\n      ngModule: NgxMdModule,\n      providers: [NgxMdConfig]\n    };\n  }\n}\n"]}